---
import { SITE_TITLE } from "@/config/site.config";
import { ModeToggle } from "@/components/ModeToggle";
import { Button } from "@/components/ui/button";
import { LanguageSwitcher } from "@/components/LanguageSwitcher";
import { getLocaleFromUrl, getNavItems } from "@/i18n";

const locale = getLocaleFromUrl(Astro.url);
const navItems = getNavItems(locale);
const rssPath = locale === 'en' ? '/en/rss.xml' : '/rss.xml';
const homePath = locale === 'en' ? '/en' : '/';
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60">
  <div class="container mx-auto px-4">
    <div class="flex h-14 items-center justify-between">
      <div class="flex items-center gap-2 shrink-0">
        <a href={homePath} class="font-bold text-lg sm:text-xl hover:text-primary transition-colors whitespace-nowrap">
          {SITE_TITLE}
        </a>
        <a
          href={rssPath}
          class="text-muted-foreground hover:text-foreground transition-colors"
          aria-label="RSS Feed"
          title="RSS Feed"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M4 11a9 9 0 0 1 9 9" />
            <path d="M4 4a16 16 0 0 1 16 16" />
            <circle cx="5" cy="19" r="1" />
          </svg>
        </a>
      </div>

      <nav class="hidden md:flex items-center gap-1">
        {
          navItems.map((item) => (
            <a href={item.href}>
              <Button variant="ghost" size="sm">
                {item.title}
              </Button>
            </a>
          ))
        }
        <LanguageSwitcher client:load currentLocale={locale} currentPath={currentPath} />
        <ModeToggle client:load />
      </nav>

      <!-- Mobile menu button -->
      <div class="flex md:hidden items-center gap-2">
        <LanguageSwitcher client:load currentLocale={locale} currentPath={currentPath} />
        <ModeToggle client:load />
        <button
          id="mobile-menu-btn"
          class="p-2 hover:bg-accent rounded-md"
          aria-label="Toggle menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="4" x2="20" y1="12" y2="12"></line>
            <line x1="4" x2="20" y1="6" y2="6"></line>
            <line x1="4" x2="20" y1="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <nav
      id="mobile-menu"
      class="hidden md:hidden pb-4 border-t pt-4"
    >
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="block py-2 px-2 hover:bg-accent rounded-md transition-colors"
          >
            {item.title}
          </a>
        ))
      }
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");

  btn?.addEventListener("click", () => {
    menu?.classList.toggle("hidden");
  });
</script>
