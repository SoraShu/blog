---
/**
 * 浮动操作按钮组件
 * 显示在博文页面右下角，提供返回顶部和返回主页功能
 */
---

<div class="floating-actions">
  <button
    id="back-to-top"
    class="floating-btn inline-flex items-center justify-center size-10 rounded-full border bg-background shadow-md hover:bg-accent hover:text-accent-foreground transition-all"
    aria-label="返回顶部"
    title="返回顶部"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="m18 15-6-6-6 6"/>
    </svg>
  </button>
  
  <a
    href="/"
    class="inline-flex items-center justify-center size-10 rounded-full border bg-background shadow-md hover:bg-accent hover:text-accent-foreground transition-all"
    aria-label="返回主页"
    title="返回主页"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
      <polyline points="9 22 9 12 15 12 15 22"/>
    </svg>
  </a>
</div>

<style>
  .floating-actions {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    z-index: 40;
  }
  
  .floating-btn {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, background-color 0.2s ease;
  }
  
  .floating-btn.visible {
    opacity: 1;
    pointer-events: auto;
  }
  
  /* 在较小屏幕上调整位置 */
  @media (max-width: 1280px) {
    .floating-actions {
      right: 1rem;
      bottom: 1.5rem;
    }
  }
</style>

<script>
  function initFloatingActions() {
    const backToTopBtn = document.getElementById('back-to-top');
    const floatingActions = document.querySelector('.floating-actions') as HTMLElement;
    const footer = document.querySelector('footer');
    
    if (!backToTopBtn || !floatingActions) return;
    
    const defaultBottom = 32; // 2rem = 32px
    const bufferSpace = 16; // 额外间距
    
    const updatePosition = () => {
      // 显示/隐藏返回顶部按钮
      if (window.scrollY > 300) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
      
      // 调整位置避免与 footer 重叠
      if (footer) {
        const footerRect = footer.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        const buttonsHeight = floatingActions.offsetHeight;
        
        // 当 footer 进入视口时
        if (footerRect.top < windowHeight) {
          const overlap = windowHeight - footerRect.top + bufferSpace;
          floatingActions.style.bottom = `${Math.max(defaultBottom, overlap)}px`;
        } else {
          floatingActions.style.bottom = `${defaultBottom}px`;
        }
      }
    };
    
    // 初始检查
    updatePosition();
    
    // 监听滚动
    window.addEventListener('scroll', updatePosition, { passive: true });
    window.addEventListener('resize', updatePosition, { passive: true });
    
    // 点击返回顶部
    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }
  
  // 初始化
  initFloatingActions();
  document.addEventListener('astro:after-swap', initFloatingActions);
</script>
