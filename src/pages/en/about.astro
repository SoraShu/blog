---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Card, CardContent } from "@/components/ui/card";
import { CONTENT_ABOUT_PATH } from "@/config/site.config";
import { t, getContentPath } from "@/i18n";
import fs from "node:fs";
import path from "node:path";
import MarkdownIt from "markdown-it";

const locale = 'en';

// 读取对应语言的 about 文件
const basePath = CONTENT_ABOUT_PATH.replace(/\.md$/, '');
const aboutPath = path.resolve(getContentPath(basePath, locale));

// 如果对应语言文件不存在，回退到默认文件
let actualPath = aboutPath;
if (!fs.existsSync(aboutPath)) {
  actualPath = path.resolve(CONTENT_ABOUT_PATH);
}

const aboutContent = fs.readFileSync(actualPath, "utf-8");

// 移除 frontmatter
const contentWithoutFrontmatter = aboutContent.replace(/^---[\s\S]*?---\n*/, "");

// 渲染 Markdown
const md = new MarkdownIt({
  html: true,
  linkify: true,
});
const htmlContent = md.render(contentWithoutFrontmatter);
---

<BaseLayout title={t('page.about.title', locale)} description={t('page.about.description', locale)} locale={locale}>
  <div class="max-w-3xl mx-auto">
    <h1 class="text-4xl font-bold mb-8 text-center">{t('page.about.title', locale)}</h1>

    <Card>
      <CardContent className="prose dark:prose-invert p-8">
        <Fragment set:html={htmlContent} />
      </CardContent>
    </Card>
  </div>
</BaseLayout>
